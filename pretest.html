<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Virtual Labs | Electrical Machines Lab - Theory</title>
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="./alert-theme.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    body {
      font-family: 'Inter', sans-serif;
    }
    /* Page blur when intro popup is open */
    body.body-blurred #page-wrapper {
      filter: blur(5px);
      pointer-events: none;
      user-select: none;
    }
    body.body-blurred {
      overflow: hidden;
    }
    /* Custom Animations */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .animate-fadeInUp {
      animation: fadeInUp 0.6s ease-out forwards;
    }
    @keyframes slideInLeft {
      from {
        opacity: 0;
        transform: translateX(-20px);
      }
        to {
        opacity: 1;
        transform: translateX(0);
      }
    }
    .animate-slideInLeft {
      animation: slideInLeft 0.5s ease-out forwards;
    }
    @keyframes chatbot-float {
      0%, 100% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(-4px);
      }
    }

    @keyframes chatbot-hint-pulse {
      0%, 65% {
        opacity: 0;
        transform: translate(8px, -50%) scale(0.94);
      }
      10%, 40% {
        opacity: 1;
        transform: translate(0, -50%) scale(1);
      }
      100% {
        opacity: 0;
        transform: translate(8px, -50%) scale(0.94);
      }
    }
    /* Stagger animation for menu items */
    .menu-item:nth-child(1) { animation-delay: 0.1s; }
    .menu-item:nth-child(2) { animation-delay: 0.2s; }
    .menu-item:nth-child(3) { animation-delay: 0.3s; }
    .menu-item:nth-child(4) { animation-delay: 0.4s; }
    .menu-item:nth-child(5) { animation-delay: 0.5s; }
    .menu-item:nth-child(6) { animation-delay: 0.6s; }
    .menu-item:nth-child(7) { animation-delay: 0.7s; }
    .menu-item:nth-child(8) { animation-delay: 0.8s; }
    /* Section stagger */
    .section-content:nth-child(even) { animation-delay: 0.2s; }
    .section-content:nth-child(odd) { animation-delay: 0.1s; }
    /* Virtual Labs specific styling */
    .vl-header {
       height: 70px;
      background: linear-gradient(120deg, #021a2c, #064073, #0b60a8);
      box-shadow: 0 10px 30px rgba(2, 26, 44, 0.35);
    }
    .header-inner {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.75rem 1rem; /* Increased padding for better breathing room */
    }
    .top-nav {
      gap: 1.5rem; /* Increased gap for better spacing */
      align-items: center;
    }
    .nav-link {
      position: relative;
      color: #e2e8f0;
      font-weight: 600;
      padding: 0.5rem 1rem; /* Slightly increased padding */
      transition: color 150ms ease, transform 150ms ease; /* Added subtle transform */
      border-radius: 0.375rem; /* Subtle rounding */
      text-decoration: none;
    }
    .nav-link::after {
      content: '';
      position: absolute;
      left: 0;
      right: 0;
      bottom: -6px;
      height: 2px;
      border-radius: 999px;
      background: linear-gradient(120deg, #021a2c, #064073, #0b60a8);
      transform: scaleX(0);
      transform-origin: center;
      transition: transform 200ms ease;
    }
    .nav-link:hover,
    .nav-link:focus {
      color: #fff;
      transform: translateY(-1px); /* Subtle lift on hover */
      background: rgba(255, 255, 255, 0.1); /* Subtle background on hover */
    }
    .nav-link:hover::after,
    .nav-link:focus::after {
      transform: scaleX(1);
    }
    /* Logo improvements */
    .logo-container {
      display: flex;
      align-items: center;
      gap: 0.75rem; /* Consistent gap */
    }
    .logo-glow {
      transition: transform 200ms ease, box-shadow 200ms ease;
    }
    .logo-glow:hover {
      transform: scale(1.05);
      box-shadow: 0 0 20px rgba(11, 96, 168, 0.5);
    }
    .logo-text {
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    .logo-title {
      color: #fff;
      font-size: 1.25rem;
      font-weight: 700;
      line-height: 1.2;
      margin: 0;
    }
    .logo-subtitle {
      color: #bfdbfe;
      font-size: 0.875rem;
      font-weight: 500;
      margin: 0;
    }
   .flex-1.pt-16 {
    flex: 1;
  }
  .vl-footer {
    background: linear-gradient(120deg, #021a2c, #064073, #0b60a8);
    color: #e2e8f0;
    padding: 1.25rem 0;
    box-shadow: 0 -10px 30px rgba(2, 26, 44, 0.5);
    backdrop-filter: blur(10px);
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    z-index: 50;
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
  }
  .footer-inner {
    max-width: 1200px;
    margin: 0 auto;
    text-align: center;
    padding: 0 1.5rem;
  }
    .vl-sidebar {
      background: #f8fafc;
      border-right: 1px solid #e2e8f0;
    }
    .vl-card {
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }
    .menu-item {
      border-left: 3px solid transparent;
      background: rgba(255, 255, 255, 0.6);
      border-radius: 0.75rem;
      transition: transform 220ms ease, box-shadow 220ms ease, background 220ms ease;
      position: relative;
      overflow: hidden;
      backdrop-filter: blur(4px);
      box-shadow: inset 0 -1px 0 rgba(255, 255, 255, 0.6);
    }

    .menu-item::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(120deg, rgba(11, 96, 168, 0.15), transparent 60%);
      opacity: 0;
      transform: translateX(-100%);
      transition: opacity 220ms ease, transform 220ms ease;
    }

    .menu-item:hover::after {
      opacity: 1;
      transform: translateX(0);
    }

    .menu-item:hover,
    .menu-item.active {
      border-left-color: #0b60a8;
      background: rgba(255, 255, 255, 0.85);
      transform: translateX(6px);
      box-shadow: 0 12px 30px rgba(2, 26, 44, 0.15);
    }

    .menu-item.active::after {
      opacity: 1;
      transform: translateX(0);
    }

    /* Override Tailwind blue accents with lab primary theme */
    .bg-blue-600,
    .hover\:bg-blue-700:hover {
      background: linear-gradient(120deg, #021a2c, #064073, #0b60a8);
    }

    .text-blue-600,
    .hover\:text-blue-600:hover {
      color: #0b60a8;
    }

    .border-blue-600 {
      border-color: #0b60a8;
    }
    #intro-text .intro-line {
      margin: 0 0 0.85rem;
      color: #1f2933;
      line-height: 1.6;
      opacity: 0.65;
      transition: opacity 160ms ease, transform 160ms ease;
    }
    #intro-text .intro-line:last-child {
      margin-bottom: 0;
    }
    #intro-text .intro-line.active {
      opacity: 1;
      color: #0f172a;
      font-weight: 600;
      transform: translateX(2px);
    }
    .chatbot-launcher {
      width: 74px;
      height: 74px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #ffffff, #dbeafe);
      box-shadow: 0 25px 45px rgba(15, 23, 42, 0.35);
      border: 2px solid rgba(255, 255, 255, 0.35);
      cursor: pointer;
      transition: transform 160ms ease, box-shadow 160ms ease;
      position: relative;
      z-index: 1;
      overflow: visible;
    }
    .chatbot-launcher::before,
    .chatbot-launcher::after {
      content: '';
      position: absolute;
      inset: -4px;
      border-radius: inherit;
      background: conic-gradient(from 160deg,
        rgba(59, 130, 246, 0.25),
        rgba(14, 165, 233, 0.65),
        rgba(59, 130, 246, 0.95),
        rgba(14, 165, 233, 0.65),
        rgba(59, 130, 246, 0.25)
      );
      opacity: 0;
      transform: scale(0.9);
      transition: opacity 180ms ease, transform 180ms ease;
      z-index: -1;
    }
    .chatbot-launcher::after {
      filter: blur(12px);
    }
    .chatbot-launcher:hover::before,
    .chatbot-launcher:hover::after {
      opacity: 1;
      transform: scale(1.05);
    }
    .chatbot-launcher:hover {
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 30px 60px rgba(15, 23, 42, 0.45);
    }
    .chatbot-launcher-image {
      width: 58px;
      height: 58px;
      object-fit: contain;
      filter: drop-shadow(0 0 10px rgba(59, 130, 246, 0.65));
      animation: chatbot-float 2.4s ease-in-out infinite;
    }
    .chatbot-hint-bubble {
      position: absolute;
      right: 100%;
      top: 50%;
      transform: translate(8px, -50%) scale(0.94);
      margin-right: 0.75rem;
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.35rem 0.7rem;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.96);
      color: #e0f2fe;
      font-size: 0.72rem;
      font-weight: 600;
      white-space: nowrap;
      box-shadow: 0 16px 30px rgba(15, 23, 42, 0.55);
      animation: chatbot-hint-pulse 4.2s ease-in-out infinite;
      pointer-events: none;
    }
    .chatbot-hint-dot {
      width: 22px;
      height: 22px;
      border-radius: 999px;
      background: #38bdf8;
      box-shadow: 0 0 0 6px rgba(56, 189, 248, 0.25);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      font-weight: 700;
      color: #0f172a;
    }
    @media (max-width: 640px) {
      .chatbot-launcher {
        width: 64px;
        height: 64px;
      }
      .chatbot-launcher-image {
        width: 50px;
        height: 50px;
      }
      .chatbot-hint-bubble {
        display: none;
      }
    }
    .chatbot-widget {
      position: fixed;
      bottom: 28px;
      right: 28px;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 0.9rem;
      z-index: 90;
      max-width: calc(100vw - 32px);
    }
    .chatbot-widget.chatbot-open .chatbot-hint-bubble,
    .chatbot-widget:hover .chatbot-hint-bubble {
      animation: none;
      opacity: 0;
    }
    .chatbot-panel {
      width: min(420px, calc(100vw - 40px));
      height: min(600px, calc(100vh - 140px));
      background: #ffffff;
      border-radius: 22px;
      box-shadow: 0 30px 60px rgba(2, 38, 61, 0.45);
      border: 1px solid rgba(15, 23, 42, 0.1);
      transform-origin: bottom right;
      transform: translateY(12px) scale(0.94);
      opacity: 0;
      pointer-events: none;
      transition: opacity 220ms ease, transform 220ms ease;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    .chatbot-panel.open {
      opacity: 1;
      transform: translateY(0) scale(1);
      pointer-events: auto;
    }
   .chatbot-panel-header {
      padding: 1.1rem 1.35rem;
      background: linear-gradient(120deg, #021a2c, #064073, #0b60a8);
      color: #fff;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 1rem;
    }
    .chatbot-panel-title {
      font-size: 1.05rem;
      font-weight: 700;
      margin: 0;
    }
    .chatbot-panel-caption {
      font-size: 0.78rem;
      opacity: 0.9;
      margin: 0;
    }
    .chatbot-panel-close {
      border: none;
      background: rgba(255, 255, 255, 0.18);
      color: #fff;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background 120ms ease;
    }
    .chatbot-panel-close:hover {
      background: rgba(255, 255, 255, 0.3);
    }
    .chatbot-panel-body {
      flex: 1;
      background: linear-gradient(180deg, #f8fafc 0%, #eef2f7 100%);
      position: relative;
      border-top: 1px solid rgba(15, 23, 42, 0.06);
    }
    .chatbot-panel-placeholder {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 1.5rem;
      color: #475569;
      font-size: 0.92rem;
      line-height: 1.5;
    }
    .chatbot-panel iframe {
      width: 100%;
      height: 100%;
      border: none;
      background: #fff;
      border-radius: 24px 24px 0 0;
      display: none;
      overflow: hidden;
      scrollbar-width: none;
    }
    .chatbot-panel iframe::-webkit-scrollbar {
      display: none;
    }
    .chatbot-panel iframe.chatbot-frame-visible {
      display: block;
    }
    /* Improved text alignment in sections */
    .section-text {
      text-align: left; /* Ensure left alignment for readability */
      line-height: 1.7; /* Improved line height for better spacing */
      hyphens: auto; /* Allow soft hyphens for long words */
    }
    .section-text p {
      margin-bottom: 1rem; /* Consistent paragraph spacing */
      text-indent: 0; /* No indentation, use spacing instead */
    }
    @media (max-width: 640px) {
      .chatbot-widget {
        bottom: 16px;
        right: 16px;
        width: calc(100vw - 24px);
      }
      .chatbot-panel {
        width: 100%;
        height: min(82vh, 580px);
        border-radius: 20px;
      }
    }
    @media (max-width: 480px) {
      .chatbot-panel {
        height: min(88vh, 620px);
      }
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">
  <!-- HEADER -->
  <header class="vl-header shadow-xl fixed top-0 left-0 right-0 z-50">
    <div class="header-inner px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between py-1 w-full gap-3">
        <a href="../../main.html" class="logo-container hover:no-underline focus:no-underline">
          <img 
            src="./images/image.png" 
            alt="Virtual Labs Logo" 
            class="h-8 w-8 sm:h-10 sm:w-10 lg:h-12 lg:w-12 rounded-xl object-contain bg-white p-1.5 logo-glow"
            onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22%3E%3Crect fill=%22%230b60a8%22 width=%22100%22 height=%22100%22/%3E%3Ctext x=%2250%22 y=%2255%22 font-size=%2240%22 text-anchor=%22middle%22 fill=%22white%22 font-family=%22Arial%22 font-weight=%22bold%22%3EVL%3C/text%3E%3C/svg%3E'"
          >
          <div class="logo-text">
            <h1 class="logo-title text-base sm:text-lg lg:text-xl">Virtual Labs</h1>
            <p class="logo-subtitle text-[10px] sm:text-xs lg:text-sm">IIT Roorkee</p>
          </div>
        </a>

        <button 
          id="mobile-menu-toggle" 
          class="lg:hidden text-white p-2 menu-button"
          aria-label="Toggle menu"
        >
          <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>

        <nav class="top-nav hidden lg:flex items-center gap-2 lg:gap-3">
          <a href="../../main.html" class="nav-link">Home</a>
          <a href="user_input.html?return=pretest.html" class="nav-link" data-user-input-link data-redirect-return="pretest.html">User Input</a>
 
        </nav>
      </div>
    </div>
  </header>

 <div class="flex pt-16 min-h-screen">
    <!-- Sidebar -->
    <aside id="sidebar" class="vl-sidebar w-64 fixed inset-y-0 left-0 z-40 overflow-y-auto transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out pt-20 lg:pt-6 pb-6">
      <div class="px-4">
        <h2 class="text-lg font-semibold text-gray-800 mb-6 border-b border-gray-200 pb-4">Experiment Navigation</h2>
        <nav class="space-y-1">
           <a href="aim.html" class="menu-item flex items-center px-4 py-3 text-gray-700 rounded-lg group">
    <svg class="w-5 h-5 mr-3 opacity-70 group-hover:opacity-100" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
    </svg>
    Aim
  </a>
  <a href="theory.html" class="menu-item flex items-center px-4 py-3 text-gray-700 rounded-lg group">
    <svg class="w-5 h-5 mr-3 opacity-70 group-hover:opacity-100" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
    </svg>
    Theory
  </a>
  <a href="pretest.html" class="menu-item flex items-center px-4 py-3 text-gray-700 rounded-lg group">
    <svg class="w-5 h-5 mr-3 opacity-70 group-hover:opacity-100" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
    </svg>
    Pretest
  </a>
  <a href="procedure.html" class="menu-item flex items-center px-4 py-3 text-gray-700 rounded-lg group">
    <svg class="w-5 h-5 mr-3 opacity-70 group-hover:opacity-100" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2m-6 9l2 2 4-4"></path>
    </svg>
    Procedure
  </a>
  <a href="simulation.html" class="menu-item flex items-center px-4 py-3 text-gray-700 rounded-lg group">
    <svg class="w-5 h-5 mr-3 opacity-70 group-hover:opacity-100" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
    </svg>
    Simulation
  </a>
  <a href="posttest.html" class="menu-item flex items-center px-4 py-3 text-gray-700 rounded-lg group">
    <svg class="w-5 h-5 mr-3 opacity-70 group-hover:opacity-100" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
    </svg>
    Posttest
  </a>
  <a href="references.html" class="menu-item flex items-center px-4 py-3 text-gray-700 rounded-lg group">
    <svg class="w-5 h-5 mr-3 opacity-70 group-hover:opacity-100" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"></path>
    </svg>
    References
  </a>
  <a href="contributors.html" class="menu-item flex items-center px-4 py-3 text-gray-700 rounded-lg group">
    <svg class="w-5 h-5 mr-3 opacity-70 group-hover:opacity-100" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
    </svg>
    Contributors
  </a>
  <a href="progressreport.html" class="menu-item flex items-center px-4 py-3 text-gray-700 rounded-lg group">
    <svg class="w-5 h-5 mr-3 opacity-70 group-hover:opacity-100" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
    </svg>
    Progress Report
  </a>
        </nav>
      </div>
    </aside>
    <!-- MOBILE OVERLAY -->
    <div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden hidden"></div>
    <!-- MAIN CONTENT -->
    <main class="flex-1 lg:ml-64 p-6">
      <!-- Breadcrumb -->
      <nav class="mb-6 text-sm text-gray-600 animate-slideInLeft flex items-center space-x-2">
        <a href="#" class="hover:text-blue-600 transition-colors">Home</a>
        <span>></span>
        <a href="#" class="hover:text-blue-600">Electrical Machines Lab</a>
        <span>></span>
        <span class="text-gray-800 font-medium">Pretest</span>
      </nav>
      <!-- TITLE CARD -->
      <div class="vl-card mb-4 overflow-hidden animate-fadeInUp rounded-lg">
        <div class="px-4 py-3" style="background: linear-gradient(120deg, #021a2c, #064073, #0b60a8);">
          <h1 class="text-lg md:text-xl font-bold text-white text-center leading-snug">
            To study the Load Characteristics of DC shunt generator
          </h1>
        </div>
      </div>
      <!-- Theory Questions -->
      <section class="vl-card p-6 animate-fadeInUp">
     
        <div id="mcq-container" class="space-y-6 text-gray-700 text-lg"></div>
<!-- Controls: Refresh + Check (LEFT SIDE) -->
<div class="mt-6 flex items-center gap-3">
  <div class="flex gap-2">
    <button id="refresh-btn"
      class="bg-gray-300 hover:bg-gray-400 text-gray-800 px-4 py-2 rounded-lg font-semibold">
      Refresh Questions
    </button>
    <button id="check-btn"
      class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-semibold">
      Check Answers
    </button>
  </div>
  <div class="flex-1"></div>
</div>
<p id="result" class="mt-4 text-xl font-semibold"></p>
      </section>
    </main>
  </div>
  <!-- FOOTER -->
  <footer class="vl-footer fixed bottom-0 left-0 right-0 z-50 h-12"> <!-- Key: h-12 = 48px -->
    <div class="footer-inner flex items-center justify-center h-full px-4">
      <p class="text-xs md:text-sm text-center text-sky-100 font-medium tracking-wide">
        &copy; 2026 Virtual Labs IIT Roorkee
      </p>
    </div>
  </footer>

  <!-- Alert Modal (matches simulation popup style) -->
  <div id="warningModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" aria-describedby="modalMessage">
    <div class="modal-box danger" role="document">
      <h2 id="modalTitle">Alert</h2>
      <p id="modalMessage"></p>
      <button type="button" class="modal-close-btn" data-modal-close>OK</button>
    </div>
  </div>

  <audio id="alertSound" preload="auto"></audio>

<script>
/* ------------------ 20 QUESTIONS ------------------ */
 const questions = [
  {id:1,text:'DC shunt generator has terminal voltage versus load current characteristic which is',choices:['A. Constant','B. Slightly drooping','C. Slightly rising','D. Highly drooping'],answer:'B',selected:null},
  {id:2,text:'Which dc generator gives constant output voltage at all loads?',choices:['A. Shunt generator','B. Series generator','C. Short shunt compound generator','D. Level compound generator'],answer:'D',selected:null},
  {id:3,text:'The terminal voltage of dc shunt generator drops on load because of',choices:['A. Armature reaction','B. Armature resistance','C. Weak field','D. All of these'],answer:'D',selected:null},
  {id:4,text:'If the load on over-compounded dc generator is reduced, terminal voltage',choices:['A. Increases','B. Decreases','C. Unchanged','D. May change'],answer:'B',selected:null},
  {id:5,text:'Copper losses in armature of dc generator are',choices:['A. 5–10%','B. 10–20%','C. 20–30%','D. 30–40%'],answer:'A',selected:null},
  {id:6,text:'Main function of DC generator is:',choices:['A) Convert electrical→mechanical','B) Convert mechanical→electrical','C) Step up voltage','D) Step down current'],answer:'B',selected:null},
  {id:7,text:'Field winding of DC shunt generator is connected:',choices:['A) In series','B) In parallel','C) Across load','D) In series with load'],answer:'B',selected:null},
  {id:8,text:'Generated emf in DC generator:',choices:['A) E=V+IaRa','B) E=kΦN','C) E=V/I','D) E=P/I'],answer:'B',selected:null},
  {id:9,text:'Armature reaction causes:',choices:['A) Increase flux','B) Decrease flux','C) No effect','D) Constant emf'],answer:'B',selected:null},
  {id:10,text:'Load characteristic of DC shunt generator is:',choices:['A) Ia–If','B) V–IL','C) IL–speed','D) torque–speed'],answer:'B',selected:null},
  {id:11,text:'As load current increases terminal voltage:',choices:['A) Increases','B) Decreases','C) Constant','D) Zero'],answer:'B',selected:null},
  {id:12,text:'Drop in terminal voltage due to:',choices:['A) Armature reaction + resistance','B) Commutator resistance','C) Eddy current','D) Field resistance'],answer:'A',selected:null},
  {id:13,text:'Residual magnetism needed for:',choices:['A) Commutation','B) Self-excitation','C) Speed control','D) Field regulation'],answer:'B',selected:null},
  {id:14,text:'OCC curve represents:',choices:['A) V vs If (constant speed)','B) V vs IL','C) I vs R','D) torque vs speed'],answer:'A',selected:null},
  {id:15,text:'Internal characteristic shows:',choices:['A) Eg–If','B) V–If','C) Eg–Ia','D) V–Ia'],answer:'C',selected:null},
  {id:16,text:'External characteristic shows:',choices:['A) Eg–If','B) V–IL','C) Eg–Ia','D) torque–speed'],answer:'B',selected:null},
  {id:17,text:'Losses in DC generator:',choices:['A) Copper','B) Iron','C) Mechanical','D) All'],answer:'D',selected:null},
  {id:18,text:'Load test determines:',choices:['A) Armature efficiency','B) Speed regulation','C) Load characteristics','D) Field efficiency'],answer:'C',selected:null},
  {id:19,text:'Field current in DC shunt generator is:',choices:['A) Constant','B) Depends on speed','C) Depends on load','D) Zero'],answer:'C',selected:null},
  {id:20,text:'Terminal voltage at full load:',choices:['A) = Eg','B) > Eg','C) < Eg','D) Independent'],answer:'C',selected:null},
];

/* ------------------ SETTINGS ------------------ */
const size = 5; // number of questions shown per refresh
const container = document.getElementById("mcq-container");
const result = document.getElementById("result");
const refreshBtn = document.getElementById("refresh-btn");
const checkBtn = document.getElementById("check-btn");

let currentSetIndices = []; // indices into `questions` array for the current shown set
let attemptUsed = false;

/* ------------------ UTIL: pick random unique set ------------------ */
function pickRandomSet() {
  // Fisher-Yates shuffle on index array, then slice first `size`
  const indices = Array.from({length: questions.length}, (_, i) => i);
  for (let i = indices.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [indices[i], indices[j]] = [indices[j], indices[i]];
  }
  currentSetIndices = indices.slice(0, size);
  // reset selections for the newly chosen questions
  currentSetIndices.forEach(idx => questions[idx].selected = null);
  showPage();
}

/* ------------------ RENDER CURRENT SET (Q1..Q5) ------------------ */
 function showPage() {
   container.innerHTML = "";
  // Show the chosen 5 questions, numbering Q1..Q5
  currentSetIndices.forEach((qIndex, i) => {
    const q = questions[qIndex];
    const div = document.createElement("div");
    div.className = "mcq";
    div.dataset.answer = q.answer;
    div.innerHTML = `
      <p><b>Q${i + 1}.</b> ${q.text}</p>
      ${q.choices.map(c => {
        const val = c[0].toUpperCase();
        return `
          <label class="block option-label">
            <input type="radio" name="q${q.id}" value="${val}" ${q.selected === val ? "checked":""}> ${c}
          </label>
        `;
      }).join("")}
    `;
    container.appendChild(div);
    // attach change listeners to save selection into the question object
    div.querySelectorAll("input[type='radio']").forEach(inp => {
      inp.addEventListener("change", () => {
        if (attemptUsed) return;
        q.selected = inp.value;
        lockQuestionInputs(div);
      });
    });
  });
   result.innerHTML = "";
 }

function lockQuestionInputs(div) {
  div.querySelectorAll("input[type='radio']").forEach(input => {
    input.disabled = true;
  });
}

 let popupOnClose = null;

 function showPopup(message, title = "Alert", options = {}) {
   if (!message) return;
   const onClose = typeof options?.onClose === "function" ? options.onClose : null;
   popupOnClose = onClose;

   const modal = document.getElementById("warningModal");
   if (!modal) {
     window.alert(String(message));
     if (onClose) onClose();
     return;
   }

   const box = modal.querySelector(".modal-box");
   const msg = modal.querySelector("#modalMessage");
   const ttl = modal.querySelector("#modalTitle");
   const sound = document.getElementById("alertSound");
   const okBtn = modal.querySelector("[data-modal-close]");

   if (ttl) ttl.textContent = String(title || "Alert");
   if (msg) msg.textContent = String(message);

   if (box) {
     box.classList.remove("closing");
     box.classList.add("danger");
   }

   modal.classList.add("show");
   document.body.classList.add("is-modal-open");
   window.setTimeout(() => okBtn?.focus?.(), 0);

   if (sound && typeof sound.play === "function") {
     sound.currentTime = 0;
     const playPromise = sound.play();
     if (playPromise && typeof playPromise.catch === "function") {
       playPromise.catch(() => {});
     }
   }
 }

 function closePopup() {
   const modal = document.getElementById("warningModal");
   if (!modal) return;
   const box = modal.querySelector(".modal-box");
   const sound = document.getElementById("alertSound");
   const onClose = popupOnClose;
   popupOnClose = null;

   if (box) {
     box.classList.add("closing");
   }

   window.setTimeout(() => {
     modal.classList.remove("show");
     if (box) {
       box.classList.remove("closing");
     }
     document.body.classList.remove("is-modal-open");
     if (onClose) onClose();
   }, 450);

   if (sound && typeof sound.pause === "function") {
     sound.pause();
   }
 }

 function isPopupOpen() {
   const modal = document.getElementById("warningModal");
   return !!(modal && modal.classList.contains("show"));
 }

 (function initAlertModal() {
   const modal = document.getElementById("warningModal");
   if (!modal) return;

   const closeBtn = modal.querySelector("[data-modal-close]");
   if (closeBtn) closeBtn.addEventListener("click", closePopup);

   modal.addEventListener("click", (event) => {
     if (event.target === modal) {
       closePopup();
     }
   });

   document.addEventListener("keydown", (event) => {
     if (event.key === "Escape" && isPopupOpen()) {
       closePopup();
     }
   });
 })();

/* ------------------ CHECK ANSWERS for CURRENT SET ------------------ */
function attemptAlreadyUsedAlert() {
  showPopup("You have already submitted the pretest. You cannot change answers or retry.", "Notice");
}

function finalizeAttempt() {
  attemptUsed = true;
  refreshBtn.disabled = true;
  checkBtn.disabled = true;
  container.querySelectorAll("input[type='radio']").forEach(input => {
    input.disabled = true;
  });
}

function checkAnswers() {
  if (attemptUsed) {
    attemptAlreadyUsedAlert();
    return;
  }
  const unanswered = currentSetIndices.filter((qIndex) => {
    const q = questions[qIndex];
    return !container.querySelector(`input[name="q${q.id}"]:checked`);
  });

  if (unanswered.length) {
    const first = questions[unanswered[0]];
    const firstInput = first
      ? container.querySelector(`input[name="q${first.id}"]`)
      : null;
    showPopup("Please complete all the questions before checking the answers.", "Reminder", {
      onClose: () => {
        try {
          firstInput?.scrollIntoView({ behavior: "smooth", block: "center" });
          firstInput?.focus?.({ preventScroll: true });
        } catch (e) {}
      }
    });
    return;
  }

  let score = 0;
  // remove previous highlight classes
  container.querySelectorAll(".option-label").forEach(l => {
    l.classList.remove("text-green-600", "text-red-600");
  });

  currentSetIndices.forEach(qIndex => {
    const q = questions[qIndex];
    // find the selected input (if any) for this question
    const selectedInput = container.querySelector(`input[name="q${q.id}"]:checked`);
    if (selectedInput.value === q.answer) {
      score++;
      selectedInput.parentElement.classList.add("text-green-600");
    } else {
      selectedInput.parentElement.classList.add("text-red-600");
      const correctInput = container.querySelector(`input[name="q${q.id}"][value="${q.answer}"]`);
      if (correctInput) correctInput.parentElement.classList.add("text-green-600");
    }
  });

  result.innerHTML = `Your Score: ${score} / ${size}`;
  result.classList.remove("text-green-600", "text-red-600");
  result.classList.add(score === size ? "text-green-600" : "text-red-600");

  try {
    localStorage.setItem("vlab_exp2_pretest_score", String(score));
    localStorage.setItem("vlab_exp2_pretest_total", String(size));
    localStorage.setItem("vlab_exp2_pretest_updated_at", String(Date.now()));
    const activeHash = localStorage.getItem("vlab_exp2_active_user_hash");
    if (activeHash) {
      localStorage.setItem(`vlab_exp2_user_${activeHash}_pretest_score`, String(score));
      localStorage.setItem(`vlab_exp2_user_${activeHash}_pretest_total`, String(size));
      localStorage.setItem(`vlab_exp2_user_${activeHash}_pretest_updated_at`, String(Date.now()));
    }
  } catch (e) {}

  try {
    const PREFIX = "VLAB_EXP2::";
    let data = {};
    if (typeof window.name === "string" && window.name.startsWith(PREFIX)) {
      data = JSON.parse(window.name.slice(PREFIX.length)) || {};
    }
    data["vlab_exp2_pretest_score"] = String(score);
    data["vlab_exp2_pretest_total"] = String(size);
    data["vlab_exp2_pretest_updated_at"] = String(Date.now());
    window.name = PREFIX + JSON.stringify(data);
  } catch (e) {}

  finalizeAttempt();
}

/* ------------------ BUTTON BINDINGS ------------------ */
refreshBtn.addEventListener("click", () => {
  pickRandomSet();
  refreshBtn.blur();
});
checkBtn.addEventListener("click", () => {
  checkAnswers();
  checkBtn.blur();
});

/* ------------------ INITIALIZE ------------------ */
pickRandomSet();
</script>

<!-- CHATBOT WIDGET -->
<div class="chatbot-widget">
  <div class="chatbot-panel" data-chat-url="https://vlab-exp-2.netlify.app/">
    <div class="chatbot-panel-header">
      <div>
        <p class="chatbot-panel-title">Virtual Lab Assistant</p>
        <p class="chatbot-panel-caption">Ask anything about this experiment</p>
      </div>
      <button type="button" class="chatbot-panel-close" aria-label="Close chatbot">
        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>

    <div class="chatbot-panel-body">
      <div class="chatbot-panel-placeholder">
        Loading area for your chatbot. Update the <strong>data-chat-url</strong> to match your deployment.
      </div>
      <iframe title="Chatbot assistant" referrerpolicy="no-referrer" scrolling="no"></iframe>
    </div>
  </div>

    <button type="button" class="chatbot-launcher" aria-expanded="false" aria-label="Open chatbot assistant">
    <span class="chatbot-hint-bubble">
      <span class="chatbot-hint-dot">Hi </span>
       Ask anything about this experiment 
      </span>
      <img src="images/chatbot.png" alt="" aria-hidden="true" class="chatbot-launcher-image">
  </button>
</div>

<audio id="chatbot-notification-audio" preload="auto">
  <source src="live-chat-353605.mp3" type="audio/mpeg">
</audio>
 <script>
    (function () {
      const widget = document.querySelector('.chatbot-widget');
      if (!widget) {
        return;
      }

      const toggleBtn = widget.querySelector('.chatbot-launcher');
      const panel = widget.querySelector('.chatbot-panel');
      const closeBtn = widget.querySelector('.chatbot-panel-close');
      const iframe = panel.querySelector('iframe');
      const placeholder = panel.querySelector('.chatbot-panel-placeholder');
      const chatUrl = (panel.dataset.chatUrl || '').trim();
      const notifyAudio = document.getElementById('chatbot-notification-audio');

      if (!toggleBtn || !panel || !closeBtn || !iframe || !placeholder) {
        return;
      }

      let isLoaded = false;
      let autoCloseTimer = null;
 
      function openPanel() {
        panel.classList.add('open');
        toggleBtn.setAttribute('aria-expanded', 'true');
        widget.classList.add('chatbot-open');

        if (chatUrl && chatUrl !== '#') {
          if (!isLoaded) {
            placeholder.textContent = 'Loading assistant...';
            iframe.addEventListener('load', () => {
              isLoaded = true;
              iframe.classList.add('chatbot-frame-visible');
              placeholder.style.display = 'none';
            }, { once: true });
            iframe.src = chatUrl;
          }
        } else {
          placeholder.innerHTML = 'Set the <strong>data-chat-url</strong> on the chatbot panel to your chatbot link.';
        }
      }

      function closePanel() {
        panel.classList.remove('open');
        toggleBtn.setAttribute('aria-expanded', 'false');
        widget.classList.remove('chatbot-open');
        if (autoCloseTimer) {
          clearTimeout(autoCloseTimer);
          autoCloseTimer = null;
        }
      }

      toggleBtn.addEventListener('click', () => {
        if (panel.classList.contains('open')) {
          closePanel();
        } else {
          openPanel();
        }
      });

      closeBtn.addEventListener('click', closePanel);

      if (document.readyState === 'complete') {
        setTimeout(scheduleAutoOpen, 1200);
      } else {
        window.addEventListener('load', function () {
          setTimeout(scheduleAutoOpen, 1200);
        }, { once: true });
      }
    })();
  </script>   

 
  <script src="./user_input_modal.js"></script>
  <script src="./progress_tracker.js"></script>
  <script src="./progress_report_embed.js"></script>
</body>
</html>
