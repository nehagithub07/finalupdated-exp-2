<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Virtual Labs | Electrical Machines Lab - Posttest</title>
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="./alert-theme.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    body {
      font-family: 'Inter', sans-serif;
    }
    /* Page blur when intro popup is open */
    body.body-blurred #page-wrapper {
      filter: blur(5px);
      pointer-events: none;
      user-select: none;
    }
    body.body-blurred {
      overflow: hidden;
    }
    /* Custom Animations */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .animate-fadeInUp {
      animation: fadeInUp 0.6s ease-out forwards;
    }
    @keyframes slideInLeft {
      from {
        opacity: 0;
        transform: translateX(-20px);
      }
        to {
        opacity: 1;
        transform: translateX(0);
      }
    }
    .animate-slideInLeft {
      animation: slideInLeft 0.5s ease-out forwards;
    }
    @keyframes chatbot-float {
      0%, 100% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(-4px);
      }
    }

    @keyframes chatbot-hint-pulse {
      0%, 65% {
        opacity: 0;
        transform: translate(8px, -50%) scale(0.94);
      }
      10%, 40% {
        opacity: 1;
        transform: translate(0, -50%) scale(1);
      }
      100% {
        opacity: 0;
        transform: translate(8px, -50%) scale(0.94);
      }
    }
    /* Stagger animation for menu items */
    .menu-item:nth-child(1) { animation-delay: 0.1s; }
    .menu-item:nth-child(2) { animation-delay: 0.2s; }
    .menu-item:nth-child(3) { animation-delay: 0.3s; }
    .menu-item:nth-child(4) { animation-delay: 0.4s; }
    .menu-item:nth-child(5) { animation-delay: 0.5s; }
    .menu-item:nth-child(6) { animation-delay: 0.6s; }
    .menu-item:nth-child(7) { animation-delay: 0.7s; }
    .menu-item:nth-child(8) { animation-delay: 0.8s; }
    /* Section stagger */
    .section-content:nth-child(even) { animation-delay: 0.2s; }
    .section-content:nth-child(odd) { animation-delay: 0.1s; }
    /* Virtual Labs specific styling */
    .vl-header {
       height: 70px;
      background: linear-gradient(120deg, #021a2c, #064073, #0b60a8);
      box-shadow: 0 10px 30px rgba(2, 26, 44, 0.35);
    }
    .header-inner {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.75rem 1rem; /* Increased padding for better breathing room */
    }
    .top-nav {
      gap: 1.5rem; /* Increased gap for better spacing */
      align-items: center;
    }
    .nav-link {
      position: relative;
      color: #e2e8f0;
      font-weight: 600;
      padding: 0.5rem 1rem; /* Slightly increased padding */
      transition: color 150ms ease, transform 150ms ease; /* Added subtle transform */
      border-radius: 0.375rem; /* Subtle rounding */
      text-decoration: none;
    }
    .nav-link::after {
      content: '';
      position: absolute;
      left: 0;
      right: 0;
      bottom: -6px;
      height: 2px;
      border-radius: 999px;
      background: linear-gradient(120deg, #021a2c, #064073, #0b60a8);
      transform: scaleX(0);
      transform-origin: center;
      transition: transform 200ms ease;
    }
    .nav-link:hover,
    .nav-link:focus {
      color: #fff;
      transform: translateY(-1px); /* Subtle lift on hover */
      background: rgba(255, 255, 255, 0.1); /* Subtle background on hover */
    }
    .nav-link:hover::after,
    .nav-link:focus::after {
      transform: scaleX(1);
    }
    /* Logo improvements */
    .logo-container {
      display: flex;
      align-items: center;
      gap: 0.75rem; /* Consistent gap */
    }
    .logo-glow {
      transition: transform 200ms ease, box-shadow 200ms ease;
    }
    .logo-glow:hover {
      transform: scale(1.05);
      box-shadow: 0 0 20px rgba(11, 96, 168, 0.5);
    }
    .logo-text {
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    .logo-title {
      color: #fff;
      font-size: 1.25rem;
      font-weight: 700;
      line-height: 1.2;
      margin: 0;
    }
    .logo-subtitle {
      color: #bfdbfe;
      font-size: 0.875rem;
      font-weight: 500;
      margin: 0;
    }
   .flex-1.pt-16 {
    flex: 1;
  }
  .vl-footer {
    background: linear-gradient(120deg, #021a2c, #064073, #0b60a8);
    color: #e2e8f0;
    padding: 1.25rem 0;
    box-shadow: 0 -10px 30px rgba(2, 26, 44, 0.5);
    backdrop-filter: blur(10px);
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    z-index: 50;
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
  }
  .footer-inner {
    max-width: 1200px;
    margin: 0 auto;
    text-align: center;
    padding: 0 1.5rem;
  }
    .vl-sidebar {
      background: #f8fafc;
      border-right: 1px solid #e2e8f0;
    }
    .vl-card {
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }
    .menu-item {
      border-left: 3px solid transparent;
      background: rgba(255, 255, 255, 0.6);
      border-radius: 0.75rem;
      transition: transform 220ms ease, box-shadow 220ms ease, background 220ms ease;
      position: relative;
      overflow: hidden;
      backdrop-filter: blur(4px);
      box-shadow: inset 0 -1px 0 rgba(255, 255, 255, 0.6);
    }

    .menu-item::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(120deg, rgba(11, 96, 168, 0.15), transparent 60%);
      opacity: 0;
      transform: translateX(-100%);
      transition: opacity 220ms ease, transform 220ms ease;
    }

    .menu-item:hover::after {
      opacity: 1;
      transform: translateX(0);
    }

    .menu-item:hover,
    .menu-item.active {
      border-left-color: #0b60a8;
      background: rgba(255, 255, 255, 0.85);
      transform: translateX(6px);
      box-shadow: 0 12px 30px rgba(2, 26, 44, 0.15);
    }

    .menu-item.active::after {
      opacity: 1;
      transform: translateX(0);
    }

    /* Override Tailwind blue accents with lab primary theme */
    .bg-blue-600,
    .hover\:bg-blue-700:hover {
      background: linear-gradient(120deg, #021a2c, #064073, #0b60a8);
    }

    .text-blue-600,
    .hover\:text-blue-600:hover {
      color: #0b60a8;
    }

    .border-blue-600 {
      border-color: #0b60a8;
    }

    /* Check button disabled state */
    #check-btn:disabled {
      opacity: 0.55;
      cursor: not-allowed;
      background: linear-gradient(120deg, #cbd5e1, #e2e8f0);
      color: #475569;
      border-color: #cbd5e1;
      box-shadow: none;
    }

    /* Refresh button disabled state */
    #refresh-btn:disabled {
      opacity: 0.55;
      cursor: not-allowed;
      background: linear-gradient(120deg, #e2e8f0, #f8fafc);
      color: #475569;
      border-color: #e2e8f0;
      box-shadow: none;
    }

    /* MCQ styling */
    .mcq {
      border: 1px solid #e2e8f0;
      border-radius: 14px;
      padding: 12px 14px;
      background: linear-gradient(135deg, #f8fafc, #eef2ff);
      box-shadow: 0 6px 12px rgba(15, 23, 42, 0.06);
    }

    .option-label {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      margin-top: 8px;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      background: linear-gradient(120deg, #ffffff, #f8fbff);
      transition: all 160ms ease;
      cursor: pointer;
    }

    .option-label:hover {
      border-color: #93c5fd;
      box-shadow: 0 10px 20px rgba(14, 165, 233, 0.18);
      transform: translateY(-1px);
    }

    .option-label input {
      accent-color: #0b60a8;
      width: 18px;
      height: 18px;
    }

    .option-label input:disabled {
      opacity: 1;
      filter: none;
      cursor: default;
    }

    .option-label.disabled-option {
      opacity: 0.82;
      border-style: dashed;
    }

    .option-label.selected-option {
      border-color: #0ea5e9;
      background: linear-gradient(135deg, #e0f2fe, #eef2ff);
      box-shadow: 0 12px 26px rgba(14, 165, 233, 0.22);
    }

    .option-label.correct-option {
      border-color: #22c55e;
      background: linear-gradient(135deg, #ecfdf3, #d1fae5);
      box-shadow: 0 12px 26px rgba(34, 197, 94, 0.25);
    }

    .option-label.wrong-option {
      border-color: #ef4444;
      background: linear-gradient(135deg, #fef2f2, #fee2e2);
      box-shadow: 0 12px 26px rgba(239, 68, 68, 0.22);
    }
    #intro-text .intro-line {
      margin: 0 0 0.85rem;
      color: #1f2933;
      line-height: 1.6;
      opacity: 0.65;
      transition: opacity 160ms ease, transform 160ms ease;
    }
    #intro-text .intro-line:last-child {
      margin-bottom: 0;
    }
    #intro-text .intro-line.active {
      opacity: 1;
      color: #0f172a;
      font-weight: 600;
      transform: translateX(2px);
    }
    .chatbot-launcher {
      width: 74px;
      height: 74px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #ffffff, #dbeafe);
      box-shadow: 0 25px 45px rgba(15, 23, 42, 0.35);
      border: 2px solid rgba(255, 255, 255, 0.35);
      cursor: pointer;
      transition: transform 160ms ease, box-shadow 160ms ease;
      position: relative;
      z-index: 1;
      overflow: visible;
    }
    .chatbot-launcher::before,
    .chatbot-launcher::after {
      content: '';
      position: absolute;
      inset: -4px;
      border-radius: inherit;
      background: conic-gradient(from 160deg,
        rgba(59, 130, 246, 0.25),
        rgba(14, 165, 233, 0.65),
        rgba(59, 130, 246, 0.95),
        rgba(14, 165, 233, 0.65),
        rgba(59, 130, 246, 0.25)
      );
      opacity: 0;
      transform: scale(0.9);
      transition: opacity 180ms ease, transform 180ms ease;
      z-index: -1;
    }
    .chatbot-launcher::after {
      filter: blur(12px);
    }
    .chatbot-launcher:hover::before,
    .chatbot-launcher:hover::after {
      opacity: 1;
      transform: scale(1.05);
    }
    .chatbot-launcher:hover {
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 30px 60px rgba(15, 23, 42, 0.45);
    }
    .chatbot-launcher-image {
      width: 58px;
      height: 58px;
      object-fit: contain;
      filter: drop-shadow(0 0 10px rgba(59, 130, 246, 0.65));
      animation: chatbot-float 2.4s ease-in-out infinite;
    }
    .chatbot-hint-bubble {
      position: absolute;
      right: 100%;
      top: 50%;
      transform: translate(8px, -50%) scale(0.94);
      margin-right: 0.75rem;
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.35rem 0.7rem;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.96);
      color: #e0f2fe;
      font-size: 0.72rem;
      font-weight: 600;
      white-space: nowrap;
      box-shadow: 0 16px 30px rgba(15, 23, 42, 0.55);
      animation: chatbot-hint-pulse 4.2s ease-in-out infinite;
      pointer-events: none;
    }
    .chatbot-hint-dot {
        position: relative;
  left: -5px;
      width: 22px;
      height: 22px;
      border-radius: 999px;
      background: #38bdf8;
      box-shadow: 0 0 0 6px rgba(56, 189, 248, 0.25);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      font-weight: 700;
      color: #0f172a;
    }
    @media (max-width: 640px) {
      .chatbot-launcher {
        width: 64px;
        height: 64px;
      }
      .chatbot-launcher-image {
        width: 50px;
        height: 50px;
      }
      .chatbot-hint-bubble {
        display: none;
      }
    }
    .chatbot-widget {
      position: fixed;
      bottom: 28px;
      right: 28px;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 0.9rem;
      z-index: 90;
      max-width: calc(100vw - 32px);
    }
    .chatbot-widget.chatbot-open .chatbot-hint-bubble,
    .chatbot-widget:hover .chatbot-hint-bubble {
      animation: none;
      opacity: 0;
    }
    .chatbot-panel {
      width: min(420px, calc(100vw - 40px));
      height: min(600px, calc(100vh - 140px));
      background: #ffffff;
      border-radius: 22px;
      box-shadow: 0 30px 60px rgba(2, 38, 61, 0.45);
      border: 1px solid rgba(15, 23, 42, 0.1);
      transform-origin: bottom right;
      transform: translateY(12px) scale(0.94);
      opacity: 0;
      pointer-events: none;
      transition: opacity 220ms ease, transform 220ms ease;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    .chatbot-panel.open {
      opacity: 1;
      transform: translateY(0) scale(1);
      pointer-events: auto;
    }
   .chatbot-panel-header {
      padding: 1.1rem 1.35rem;
      background: linear-gradient(120deg, #021a2c, #064073, #0b60a8);
      color: #fff;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 1rem;
    }
    .chatbot-panel-title {
      font-size: 1.05rem;
      font-weight: 700;
      margin: 0;
    }
    .chatbot-panel-caption {
      font-size: 0.78rem;
      opacity: 0.9;
      margin: 0;
    }
    .chatbot-panel-close {
      border: none;
      background: rgba(255, 255, 255, 0.18);
      color: #fff;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background 120ms ease;
    }
    .chatbot-panel-close:hover {
      background: rgba(255, 255, 255, 0.3);
    }
    .chatbot-panel-body {
      flex: 1;
      background: linear-gradient(180deg, #f8fafc 0%, #eef2f7 100%);
      position: relative;
      border-top: 1px solid rgba(15, 23, 42, 0.06);
    }
    .chatbot-panel-placeholder {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 1.5rem;
      color: #475569;
      font-size: 0.92rem;
      line-height: 1.5;
    }
    .chatbot-panel iframe {
      width: 100%;
      height: 100%;
      border: none;
      background: #fff;
      border-radius: 24px 24px 0 0;
      display: none;
      overflow: hidden;
      scrollbar-width: none;
    }
    .chatbot-panel iframe::-webkit-scrollbar {
      display: none;
    }
    .chatbot-panel iframe.chatbot-frame-visible {
      display: block;
    }
    /* Improved text alignment in sections */
    .section-text {
      text-align: left; /* Ensure left alignment for readability */
      line-height: 1.7; /* Improved line height for better spacing */
      hyphens: auto; /* Allow soft hyphens for long words */
    }
    .section-text p {
      margin-bottom: 1rem; /* Consistent paragraph spacing */
      text-indent: 0; /* No indentation, use spacing instead */
    }
    @media (max-width: 640px) {
      .chatbot-widget {
        bottom: 16px;
        right: 16px;
        width: calc(100vw - 24px);
      }
      .chatbot-panel {
        width: 100%;
        height: min(82vh, 580px);
        border-radius: 20px;
      }
    }
    @media (max-width: 480px) {
      .chatbot-panel {
        height: min(88vh, 620px);
      }
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">
  <!-- HEADER -->
  <header class="vl-header shadow-xl fixed top-0 left-0 right-0 z-50">
    <div class="header-inner px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between py-1 w-full gap-3">
        <a href="../../main.html" class="logo-container hover:no-underline focus:no-underline">
          <img 
             src="./images/image.png" 
            alt="Virtual Labs Logo" 
            class="h-8 w-8 sm:h-10 sm:w-10 lg:h-12 lg:w-12 rounded-xl object-contain bg-white p-1.5 logo-glow"
            onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22%3E%3Crect fill=%22%230b60a8%22 width=%22100%22 height=%22100%22/%3E%3Ctext x=%2250%22 y=%2255%22 font-size=%2240%22 text-anchor=%22middle%22 fill=%22white%22 font-family=%22Arial%22 font-weight=%22bold%22%3EVL%3C/text%3E%3C/svg%3E'"
          >
          <div class="logo-text">
            <h1 class="logo-title text-base sm:text-lg lg:text-xl">Virtual Labs</h1>
            <p class="logo-subtitle text-[10px] sm:text-xs lg:text-sm">IIT Roorkee</p>
          </div>
        </a>

        <button 
          id="mobile-menu-toggle" 
          class="lg:hidden text-white p-2 menu-button"
          aria-label="Toggle menu"
        >
          <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>

        <nav class="top-nav hidden lg:flex items-center gap-2 lg:gap-3">
          <a href="../../main.html" class="nav-link">Home</a>
          <a href="user_input.html?return=posttest.html" class="nav-link nav-user-link" data-user-input-link data-redirect-return="posttest.html">
            <span class="nav-user-pill">
             
              <span class="nav-user-text" data-user-text>User Input</span>
            </span>
          </a>
 
        </nav>
      </div>
    </div>
  </header>

 <div class="flex pt-16 min-h-screen">
    <!-- Sidebar -->
    <aside id="sidebar" class="vl-sidebar w-64 fixed inset-y-0 left-0 z-40 overflow-y-auto transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out pt-20 lg:pt-6 pb-6">
      <div class="px-4">
        <h2 class="text-lg font-semibold text-gray-800 mb-6 border-b border-gray-200 pb-4">Experiment Navigation</h2>
        <nav class="space-y-1">
           <a href="aim.html" class="menu-item flex items-center px-4 py-3 text-gray-700 rounded-lg group">
    <svg class="w-5 h-5 mr-3 opacity-70 group-hover:opacity-100" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
    </svg>
    Aim
  </a>
  <a href="theory.html" class="menu-item flex items-center px-4 py-3 text-gray-700 rounded-lg group">
    <svg class="w-5 h-5 mr-3 opacity-70 group-hover:opacity-100" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
    </svg>
    Theory
  </a>
  <a href="pretest.html" class="menu-item flex items-center px-4 py-3 text-gray-700 rounded-lg group">
    <svg class="w-5 h-5 mr-3 opacity-70 group-hover:opacity-100" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
    </svg>
    Pretest
  </a>
  <a href="procedure.html" class="menu-item flex items-center px-4 py-3 text-gray-700 rounded-lg group">
    <svg class="w-5 h-5 mr-3 opacity-70 group-hover:opacity-100" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2m-6 9l2 2 4-4"></path>
    </svg>
    Procedure
  </a>
  <a href="simulation.html" class="menu-item flex items-center px-4 py-3 text-gray-700 rounded-lg group">
    <svg class="w-5 h-5 mr-3 opacity-70 group-hover:opacity-100" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
    </svg>
    Simulation
  </a>
  <a href="posttest.html" class="menu-item flex items-center px-4 py-3 text-gray-700 rounded-lg group">
    <svg class="w-5 h-5 mr-3 opacity-70 group-hover:opacity-100" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
    </svg>
    Posttest
  </a>
  <a href="references.html" class="menu-item flex items-center px-4 py-3 text-gray-700 rounded-lg group">
    <svg class="w-5 h-5 mr-3 opacity-70 group-hover:opacity-100" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"></path>
    </svg>
    References
  </a>
  <a href="contributors.html" class="menu-item flex items-center px-4 py-3 text-gray-700 rounded-lg group">
    <svg class="w-5 h-5 mr-3 opacity-70 group-hover:opacity-100" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
    </svg>
    Contributors
  </a>
  <a id="progressReportNav"
     href="#progressreport"
     class="menu-item flex items-center px-4 py-3 text-gray-700 rounded-lg group"
     data-progress-report-link>

    <svg class="w-5 h-5 mr-3 opacity-70 group-hover:opacity-100" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
    </svg>

    Progress report
  </a>
        </nav>
      </div>
    </aside>
    <!-- MOBILE OVERLAY -->
    <div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden hidden"></div>
    <!-- MAIN CONTENT -->
    <main class="flex-1 lg:ml-64 p-6">
      <!-- Breadcrumb -->
      <nav class="mb-6 text-sm text-gray-600 animate-slideInLeft flex items-center space-x-2">
        <a href="#" class="hover:text-blue-600 transition-colors">Home</a>
        <span>></span>
        <a href="#" class="hover:text-blue-600">Electrical Machines Lab</a>
        <span>></span>
        <span class="text-gray-800 font-medium">Pretest</span>
      </nav>
      <!-- TITLE CARD -->
      <div class="vl-card mb-4 overflow-hidden animate-fadeInUp rounded-lg">
        <div class="px-4 py-3" style="background: linear-gradient(120deg, #021a2c, #064073, #0b60a8);">
          <h1 class="text-lg md:text-xl font-bold text-white text-center leading-snug">
            To study the Load Characteristics of DC shunt generator
          </h1>
        </div>
      </div>
      <!-- Theory Questions -->
      <section class="vl-card p-6 animate-fadeInUp">
     
        <div id="mcq-container" class="space-y-6 text-gray-700 text-lg"></div>

<!-- Controls: Refresh + Check (LEFT SIDE) -->
<div class="mt-6 flex items-center gap-3">
  <div class="flex gap-2">
    <button id="refresh-btn"
      class="bg-gray-300 hover:bg-gray-400 text-gray-800 px-4 py-2 rounded-lg font-semibold">
      Refresh Questions
    </button>
    <button id="check-btn"
      class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-semibold">
      Check Answers
    </button>
  </div>
  <div class="flex-1"></div>
</div>
<p id="result" class="mt-4 text-xl font-semibold"></p>
      </section>

      <section id="progressreport"
               class="section-content vl-card mb-8 p-6 animate-fadeInUp hidden">

        <div class="border-l-4 border-orange-600 pl-4 mb-4 flex items-center justify-between">
          <div class="flex items-center">
            <h2 class="text-2xl font-bold text-gray-800">
              Progress Report
            </h2>
          </div>
          <span class="text-sm text-gray-600">
            Embedded view (opens within this page)
          </span>
        </div>

        <div class="w-full rounded-xl overflow-hidden border border-gray-200 shadow-inner">
          <iframe
            src="progressreport.html"
            title="Progress Report"
            class="w-full"
            style="min-height: 900px;"
            loading="lazy">
          </iframe>
        </div>

      </section>

    </main>
  </div>
  <!-- FOOTER -->
  <footer class="vl-footer fixed bottom-0 left-0 right-0 z-50 h-12"> <!-- Key: h-12 = 48px -->
    <div class="footer-inner flex items-center justify-center h-full px-4">
      <p class="text-xs md:text-sm text-center text-sky-100 font-medium tracking-wide">
        &copy; 2026 Virtual Labs IIT Roorkee
      </p>
    </div>
  </footer>

  <!-- Alert Modal (matches simulation popup style) -->
  <div id="warningModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" aria-describedby="modalMessage">
    <div class="modal-box danger" role="document">
      <h2 id="modalTitle">Alert</h2>
      <p id="modalMessage"></p>
      <button type="button" class="modal-close-btn" data-modal-close>OK</button>
    </div>
  </div>

  <audio id="alertSound" preload="auto"></audio>

<script>
/* ------------------ 20 QUESTIONS ------------------ */
const questions = [
  {id:1,text:'Armature magnetic field in a DC generator produces which of the following effect?',choices:['A: It demagnetizes or reduces the main flux','B: It cross-magnetizes the main flux','C: It magnetizes or reinforces the main flux','D: Both (a) and (b)'],answer:'D',selected:null},
  {id:2,text:'Copper losses in the armature of the DC shunt generator amount to which of the following percentages of full load losses? ',choices:['A: 5 to 10%','B: 10 to 20%','C: 20 to 30%','D: 30 to 40%'],answer:'C',selected:null},
  {id:3,text:'In a DC generator, compared to the air gap under field poles, the interpole air gap is made:',choices:['A: Larger','B: Smaller','C: The same','D: Much smaller'],answer:'A',selected:null},
  {id:4,text:'If the field current of a DC shunt generator is slightly reduced during operation, the terminal voltage will:',choices:['A:  Increase sharply','B: Decrease gradually','C: Remain unchanged','D: Become zero'],answer:'B',selected:null},
  {id:5,text:'The yoke of a DC generator is made of cast iron because:',choices:['A: It is cheaper','B: It completes the magnetic path','C: It gives mechanical protection','D: All of these'],answer:'D',selected:null},
  {id:6,text:'What happens to the terminal voltage of a DC shunt generator as load increases?',choices:['A: It increases','B: It decreases','C: It remains constant','D: It first increases then decreases'],answer:'B',selected:null},
  {id:7,text:'The main reason for the drop in terminal voltage under load is:',choices:['A: Armature resistance drop and armature reaction','B: Decrease in field resistance','C: Increase in field current','D: Decrease in speed'],answer:'A',selected:null},
  {id:8,text:'What does the external characteristic curve of a DC shunt generator represent?',choices:['A: E vs Ia','B: V vs IL','C: E vs If','D: V vs N'],answer:'B',selected:null},
  {id:9,text:'If the terminal voltage of the generator falls sharply with increasing load, it indicates:',choices:['A: High armature resistance','B: Poor voltage regulation','C: Weak residual magnetism','D: Low field current'],answer:'B',selected:null},
  {id:10,text:'How can the voltage regulation of a DC shunt generator be improved?',choices:['A: By increasing armature resistance','B: By increasing field excitation','C: By reducing field current','D: By increasing speed'],answer:'B',selected:null},
  {id:11,text:'In a well-designed DC shunt generator, the voltage drop from no-load to full-load is typically:',choices:['A: Negligible','B: Around 5–10%','C: 30–40%','D: 50–60%'],answer:'B',selected:null},
  {id:12,text:'During the experiment, the load on the DC shunt generator is varied by:',choices:['A: Changing the armature speed','B: Adjusting field rheostat','C: Varying the load resistance across armature','D: Changing supply voltage'],answer:'C',selected:null},
  {id:13,text:'The reason for using a shunt field regulator in the experiment is to:',choices:['A: Protect the generator','B: Vary the excitation current','C: Maintain constant load','D: Reduce armature reaction'],answer:'B',selected:null},
  {id:14,text:'When load increases, armature current increases. This causes:',choices:['A: More voltage drop across armature resistance','B: More field flux','C: Less terminal current','D: Constant emf'],answer:'A',selected:null},
  {id:15,text:'The generated emf in the generator is directly proportional to:',choices:['A: Load current','B: Armature resistance','C: Speed and field flux','D: Terminal voltage'],answer:'C',selected:null},
  {id:16,text:'In the experiment, the field current is kept constant to obtain:',choices:['A: Open circuit characteristics','B: Load characteristics','C: Internal characteristics','D: Magnetization curve'],answer:'B',selected:null},
  {id:17,text:'The curve plotted between terminal voltage and load current is generally:',choices:['A: Straight line','B: Slightly drooping curve','C: Parabolic','D: Exponential'],answer:'B',selected:null},
  {id:18,text:'In the experiment, if the speed of the generator fluctuates, it will:',choices:['A: Have no effect on voltage','B: Cause incorrect load characteristics','C: Reduce field resistance','D: Increase copper loss'],answer:'B',selected:null},
  {id:19,text:'The load characteristics help determine:',choices:['A: Efficiency and voltage regulation','B: Field winding design','C: Commutator dimensions','D: Mechanical losses'],answer:'A',selected:null},
  {id:20,text:'Which safety precaution is essential while performing this experiment?',choices:['A: Start without excitation','B: Never exceed rated load current','C: Disconnect load suddenly','D: Operate at maximum speed'],answer:'B',selected:null},
];

/* ------------------ SETTINGS ------------------ */
const size = 5; // number of questions shown per refresh
const container = document.getElementById("mcq-container");
const result = document.getElementById("result");
const refreshBtn = document.getElementById("refresh-btn");
const checkBtn = document.getElementById("check-btn");

let currentSetIndices = []; // indices into `questions` array for the current shown set
let setLocked = false;
let totalCorrect = readStoredNumber("vlab_exp2_posttest_score");
let totalAttempted = readStoredNumber("vlab_exp2_posttest_total");
let hasRenderedSet = false;

function readStoredNumber(key) {
  try {
    const raw = localStorage.getItem(key);
    const n = Number(raw);
    return Number.isFinite(n) && n >= 0 ? n : 0;
  } catch {
    return 0;
  }
}

function persistAssessmentTotals() {
  const now = String(Date.now());
  try {
    localStorage.setItem("vlab_exp2_posttest_score", String(totalCorrect));
    localStorage.setItem("vlab_exp2_posttest_total", String(totalAttempted));
    localStorage.setItem("vlab_exp2_posttest_updated_at", now);
    const activeHash = localStorage.getItem("vlab_exp2_active_user_hash");
    if (activeHash) {
      localStorage.setItem(`vlab_exp2_user_${activeHash}_posttest_score`, String(totalCorrect));
      localStorage.setItem(`vlab_exp2_user_${activeHash}_posttest_total`, String(totalAttempted));
      localStorage.setItem(`vlab_exp2_user_${activeHash}_posttest_updated_at`, now);
    }
  } catch (e) {}

  try {
    const PREFIX = "VLAB_EXP2::";
    let data = {};
    if (typeof window.name === "string" && window.name.startsWith(PREFIX)) {
      data = JSON.parse(window.name.slice(PREFIX.length)) || {};
    }
    data["vlab_exp2_posttest_score"] = String(totalCorrect);
    data["vlab_exp2_posttest_total"] = String(totalAttempted);
    data["vlab_exp2_posttest_updated_at"] = now;
    window.name = PREFIX + JSON.stringify(data);
  } catch (e) {}
}

/* ------------------ UTIL: pick random unique set ------------------ */
function pickRandomSet() {
  // Fisher-Yates shuffle on index array, then slice first `size`
  const indices = Array.from({length: questions.length}, (_, i) => i);
  for (let i = indices.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [indices[i], indices[j]] = [indices[j], indices[i]];
  }
  currentSetIndices = indices.slice(0, size);
  // reset selections for the newly chosen questions
  currentSetIndices.forEach(idx => questions[idx].selected = null);
  setLocked = false;
  showPage();

  if (hasRenderedSet) {
    showPopup("Questions refreshed. A new set has been loaded.", "Refreshed");
  } else {
    hasRenderedSet = true;
  }
}

/* ------------------ RENDER CURRENT SET (Q1..Q5) ------------------ */
function showPage() {
  container.innerHTML = "";
  if (result) {
    result.textContent = "";
    result.classList.remove("text-green-600", "text-red-600");
  }
  // Show the chosen 5 questions, numbering Q1..Q5
  currentSetIndices.forEach((qIndex, i) => {
    const q = questions[qIndex];
    const div = document.createElement("div");
    div.className = "mcq";
    div.dataset.answer = q.answer;
    div.innerHTML = `
      <p><b>Q${i + 1}.</b> ${q.text}</p>
      ${q.choices.map(c => {
        const val = c.trim()[0].toUpperCase();
        return `
          <label class="block option-label">
            <input type="radio" name="q${q.id}" value="${val}" ${q.selected === val ? "checked":""}> ${c}
          </label>
        `;
      }).join("")}
    `;
    container.appendChild(div);
    // attach change listeners to save selection into the question object
    div.querySelectorAll("input[type='radio']").forEach(inp => {
      inp.addEventListener("change", () => {
        if (setLocked) return;
        q.selected = inp.value;
        updateCheckButtonState();
      });
    });
  });
  result.innerHTML = "";
  updateCheckButtonState();
}

function lockQuestionInputs(div) {
  div.querySelectorAll(".option-label").forEach(label => {
    label.classList.remove("selected-option", "disabled-option", "correct-option", "wrong-option", "text-green-600", "text-red-600");
  });
  div.querySelectorAll("input[type='radio']").forEach(input => {
    input.disabled = true;
    if (input.checked) input.parentElement.classList.add("selected-option");
    else input.parentElement.classList.add("disabled-option");
  });
}

function updateCheckButtonState() {
  if (!checkBtn) return;
  if (setLocked) {
    checkBtn.disabled = true;
    return;
  }
  const allAnswered = currentSetIndices.every((qIndex) => {
    const q = questions[qIndex];
    return !!container.querySelector(`input[name="q${q.id}"]:checked`);
  });
  checkBtn.disabled = !allAnswered;
}

let popupOnClose = null;

function showPopup(message, title = "Alert", options = {}) {
  if (!message) return;
  const onClose = typeof options?.onClose === "function" ? options.onClose : null;
  popupOnClose = onClose;

  const modal = document.getElementById("warningModal");
  if (!modal) {
    window.alert(String(message));
    if (onClose) onClose();
    return;
  }

  const box = modal.querySelector(".modal-box");
  const msg = modal.querySelector("#modalMessage");
  const ttl = modal.querySelector("#modalTitle");
  const sound = document.getElementById("alertSound");
  const okBtn = modal.querySelector("[data-modal-close]");

  if (ttl) ttl.textContent = String(title || "Alert");
  if (msg) msg.textContent = String(message);

  if (box) {
    box.classList.remove("closing");
    box.classList.add("danger");
  }

  modal.classList.add("show");
  document.body.classList.add("is-modal-open");
  window.setTimeout(() => okBtn?.focus?.(), 0);

  if (sound && typeof sound.play === "function") {
    sound.currentTime = 0;
    const playPromise = sound.play();
    if (playPromise && typeof playPromise.catch === "function") {
      playPromise.catch(() => {});
    }
  }
}

function closePopup() {
  const modal = document.getElementById("warningModal");
  if (!modal) return;
  const box = modal.querySelector(".modal-box");
  const sound = document.getElementById("alertSound");
  const onClose = popupOnClose;
  popupOnClose = null;

  if (box) {
    box.classList.add("closing");
  }

  window.setTimeout(() => {
    modal.classList.remove("show");
    if (box) {
      box.classList.remove("closing");
    }
    document.body.classList.remove("is-modal-open");
    if (onClose) onClose();
  }, 450);

  if (sound && typeof sound.pause === "function") {
    sound.pause();
  }
}

function isPopupOpen() {
  const modal = document.getElementById("warningModal");
  return !!(modal && modal.classList.contains("show"));
}

(function initAlertModal() {
  const modal = document.getElementById("warningModal");
  if (!modal) return;

  const closeBtn = modal.querySelector("[data-modal-close]");
  if (closeBtn) closeBtn.addEventListener("click", closePopup);

  modal.addEventListener("click", (event) => {
    if (event.target === modal) {
      closePopup();
    }
  });

  document.addEventListener("keydown", (event) => {
    if (event.key === "Escape" && isPopupOpen()) {
      closePopup();
    }
  });
})();

/* ------------------ ATTEMPT GUARD ------------------ */
function attemptAlreadyUsedAlert() {
  showPopup("This set is already checked. Use Refresh Questions to load a new set.", "Notice");
}

function finalizeAttempt() {
  setLocked = true;
  checkBtn.disabled = true;
  container.querySelectorAll("input[type='radio']").forEach(input => {
    input.disabled = true;
  });
}

/* ------------------ CHECK ANSWERS for CURRENT SET ------------------ */
function checkAnswers() {
  if (setLocked) {
    attemptAlreadyUsedAlert();
    return;
  }
  const unanswered = currentSetIndices.filter((qIndex) => {
    const q = questions[qIndex];
    return !container.querySelector(`input[name="q${q.id}"]:checked`);
  });

  if (unanswered.length) {
    const first = questions[unanswered[0]];
    const firstInput = first
      ? container.querySelector(`input[name="q${first.id}"]`)
      : null;
    showPopup("Please complete all the questions before checking the answers.", "Reminder", {
      onClose: () => {
        try {
          firstInput?.scrollIntoView({ behavior: "smooth", block: "center" });
          firstInput?.focus?.({ preventScroll: true });
        } catch (e) {}
      }
    });
    return;
  }

  let score = 0;
  // remove previous highlight classes
  container.querySelectorAll(".option-label").forEach(l => {
    l.classList.remove("text-green-600", "text-red-600", "correct-option", "wrong-option");
  });

  currentSetIndices.forEach(qIndex => {
    const q = questions[qIndex];
    // find the selected input (if any) for this question
    const selectedInput = container.querySelector(`input[name="q${q.id}"]:checked`);
    if (selectedInput.value === q.answer) {
      score++;
      selectedInput.parentElement.classList.remove("selected-option", "disabled-option");
      selectedInput.parentElement.classList.add("text-green-600", "correct-option");
    } else {
      selectedInput.parentElement.classList.remove("selected-option", "disabled-option");
      selectedInput.parentElement.classList.add("text-red-600", "wrong-option");
      const correctInput = container.querySelector(`input[name="q${q.id}"][value="${q.answer}"]`);
      if (correctInput) {
        correctInput.parentElement.classList.remove("disabled-option");
        correctInput.parentElement.classList.add("text-green-600", "correct-option");
      }
    }
  });

  const setTotal = currentSetIndices.length;
  totalCorrect += score;
  totalAttempted += setTotal;
  persistAssessmentTotals();

  result.innerHTML = `Set Score: ${score} / ${setTotal} • Overall Score: ${totalCorrect} / ${totalAttempted}`;
  result.classList.remove("text-green-600", "text-red-600");
  result.classList.add(score === setTotal ? "text-green-600" : "text-red-600");

  finalizeAttempt();
  updateCheckButtonState();
}

/* ------------------ BUTTON BINDINGS ------------------ */
refreshBtn.addEventListener("click", () => {
  pickRandomSet();
  refreshBtn.blur();
});
checkBtn.addEventListener("click", () => {
  checkAnswers();
  checkBtn.blur();
});

/* ------------------ INITIALIZE ------------------ */
pickRandomSet();
</script>

<!-- CHATBOT WIDGET -->
<div class="chatbot-widget">
  <div class="chatbot-panel" data-chat-url="https://vlab-exp-2.netlify.app/">
    <div class="chatbot-panel-header">
      <div>
        <p class="chatbot-panel-title">Virtual Lab Assistant</p>
        <p class="chatbot-panel-caption">Ask anything about this experiment</p>
      </div>
      <button type="button" class="chatbot-panel-close" aria-label="Close chatbot">
        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>

    <div class="chatbot-panel-body">
      <div class="chatbot-panel-placeholder">
        Loading area for your chatbot. Update the <strong>data-chat-url</strong> to match your deployment.
      </div>
      <iframe title="Chatbot assistant" referrerpolicy="no-referrer" scrolling="no"></iframe>
    </div>
  </div>

    <button type="button" class="chatbot-launcher" aria-expanded="false" aria-label="Open chatbot assistant">
    <span class="chatbot-hint-bubble">
      <span class="chatbot-hint-dot">Hi </span>
       Ask anything about this experiment
      </span>
      <img src="images/chatbot.png" alt="" aria-hidden="true" class="chatbot-launcher-image">
    </button>
</div>

<audio id="chatbot-notification-audio" preload="auto">
  <source src="live-chat-353605.mp3" type="audio/mpeg">
</audio>
 <script>
    (function () {
      const widget = document.querySelector('.chatbot-widget');
      if (!widget) {
        return;
      }

      const toggleBtn = widget.querySelector('.chatbot-launcher');
      const panel = widget.querySelector('.chatbot-panel');
      const closeBtn = widget.querySelector('.chatbot-panel-close');
      const iframe = panel.querySelector('iframe');
      const placeholder = panel.querySelector('.chatbot-panel-placeholder');
      const chatUrl = (panel.dataset.chatUrl || '').trim();
      const notifyAudio = document.getElementById('chatbot-notification-audio');

      if (!toggleBtn || !panel || !closeBtn || !iframe || !placeholder) {
        return;
      }

      let isLoaded = false;
      let autoCloseTimer = null;
 
      function openPanel() {
        panel.classList.add('open');
        toggleBtn.setAttribute('aria-expanded', 'true');
        widget.classList.add('chatbot-open');

        if (chatUrl && chatUrl !== '#') {
          if (!isLoaded) {
            placeholder.textContent = 'Loading assistant...';
            iframe.addEventListener('load', () => {
              isLoaded = true;
              iframe.classList.add('chatbot-frame-visible');
              placeholder.style.display = 'none';
            }, { once: true });
            iframe.src = chatUrl;
          }
        } else {
          placeholder.innerHTML = 'Set the <strong>data-chat-url</strong> on the chatbot panel to your chatbot link.';
        }
      }

      function closePanel() {
        panel.classList.remove('open');
        toggleBtn.setAttribute('aria-expanded', 'false');
        widget.classList.remove('chatbot-open');
        if (autoCloseTimer) {
          clearTimeout(autoCloseTimer);
          autoCloseTimer = null;
        }
      }

      toggleBtn.addEventListener('click', () => {
        if (panel.classList.contains('open')) {
          closePanel();
        } else {
          openPanel();
        }
      });

      closeBtn.addEventListener('click', closePanel);

      if (document.readyState === 'complete') {
        setTimeout(scheduleAutoOpen, 1200);
      } else {
        window.addEventListener('load', function () {
          setTimeout(scheduleAutoOpen, 1200);
        }, { once: true });
      }
    })();
  </script>   


  <script src="./user_input_modal.js"></script>
  <script src="./progress_tracker.js"></script>
  <script src="./progress_report_embed.js"></script>
  <script>
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        const targetId = this.getAttribute('href').substring(1);
        if (!targetId) return;

        const targetSection = document.getElementById(targetId);
        if (!targetSection) return;

        e.preventDefault();

        document.querySelectorAll('.section-content').forEach(sec => {
          sec.classList.add('hidden');
        });

        targetSection.classList.remove('hidden');

        document.querySelectorAll('.menu-item').forEach(item => {
          item.classList.remove('active');
        });

        const menuItem = this.closest('.menu-item');
        if (menuItem) menuItem.classList.add('active');

        targetSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
      });
    });
  </script>
</body>
</html>
